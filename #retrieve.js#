// --- LOADING MODULES
var express = require('express'),
    body_parser = require('body-parser'),
    redis = require('redis'),
    json2csv = require('json2csv'),
    fs = require('fs')

var client = redis.createClient("redis://:p64e05b51353cc8e25003a2b32ab8ceb802bc22be375b4ea2c99c1269e2355906@ec2-54-83-14-21.compute-1.amazonaws.com:27559")

client.on('connect', function() {
    console.log('connected');
    });

client.keys('*', function(err, keys) {

    if (err) return console.log(err);

    console.log(keys)

    // Loop over each participant and download their data
    for (var i = 0, len = keys.length; i < len; i++) {

	var PID = keys[i]
	client.get(PID, function(error, value) {

	    if (error) console.log("error", err)

	    var csv = json2csv.parse(JSON.parse(value))

	    fs.writeFile("data/"+PID+".csv", csv, function(err, result) {

		if (err) console.log("error", err);

	    })

	});
    }

});

client.quit()

